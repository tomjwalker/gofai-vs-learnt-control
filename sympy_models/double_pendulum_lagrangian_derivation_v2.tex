\documentclass{article}%
\usepackage[T1]{fontenc}%
\usepackage[utf8]{inputenc}%
\usepackage{lmodern}%
\usepackage{textcomp}%
\usepackage{lastpage}%
\usepackage{geometry}%
\geometry{tmargin=2cm,lmargin=2cm,rmargin=2cm,bmargin=2cm}%
\usepackage{amsmath}%
\usepackage{amssymb}%
\usepackage{amsfonts}%
\usepackage{bm}%
\usepackage{graphicx}%
%
\title{Lagrangian Derivation of Double Inverted Pendulum Dynamics (v2)}%
\author{Generated by SymPy and PyLaTeX}%
\date{\today}%
%
\begin{document}%
\normalsize%
\maketitle%
\tableofcontents%
\newpage%
\section{1. System Setup}%
\label{sec:1.SystemSetup}%
This document details the derivation of equations of motion for a double inverted pendulum on a cart using the Lagrangian method.\newline%
%
\paragraph{Constants defined (U is control force):}%
\label{para:Constantsdefined(Uiscontrolforce)}%

%
\[%
\displaystyle \left[ M, \  m_{1}, \  m_{2}, \  l_{1}, \  l_{2}, \  d_{1}, \  d_{2}, \  Icm_{1}, \  Icm_{2}, \  g, \  U, \  b_{slide}, \  b_{fric}, \  b_{joint1}, \  b_{joint2}, \  gear\right]%
\]%
\paragraph{Generalized coordinates (functions of time t):}%
\label{para:Generalizedcoordinates(functionsoftimet)}%

%
\begin{align*}%
q(t) &= \displaystyle \begin{pmatrix}x\\\theta_1\\\theta_2\end{pmatrix} \\%
\end{align*}%
\paragraph{Generalized velocities:}%
\label{para:Generalizedvelocities}%

%
\begin{align*}%
\dot{q}(t) &= \displaystyle \begin{pmatrix}\dot{x}\\\dot{\theta}_{1}\\\dot{\theta}_{2}\end{pmatrix} \\%
\end{align*}%
\paragraph{Generalized accelerations:}%
\label{para:Generalizedaccelerations}%

%
\begin{align*}%
\ddot{q}(t) &= \displaystyle \begin{pmatrix}\ddot{x}\\\ddot{\theta}_{1}\\\ddot{\theta}_{2}\end{pmatrix} \\%
\end{align*}

%
\section{2. Kinematics}%
\label{sec:2.Kinematics}%
\subsection{Positions}%
\label{subsec:Positions}%
Position of Cart Pivot:%
\begin{align*}%
\mathbf{r_{cart}} &= \displaystyle \begin{pmatrix}x\\0\end{pmatrix} \\%
\end{align*}%
Position of CM of Rod 1:%
\begin{align*}%
\mathbf{r_{cm1}} &= \displaystyle \begin{pmatrix}d_{1} \sin(\theta_1 ) + x\\d_{1} \cos(\theta_1 )\end{pmatrix} \\%
\end{align*}%
Position of CM of Rod 2:%
\begin{align*}%
\mathbf{r_{cm2}} &= \displaystyle \begin{pmatrix}d_{2} \sin(\theta_2 ) + l_{1} \sin(\theta_1 ) + x\\d_{2} \cos(\theta_2 ) + l_{1} \cos(\theta_1 )\end{pmatrix} \\%
\end{align*}

%
\subsection{Velocities}%
\label{subsec:Velocities}%
Velocity of Cart:%
\begin{align*}%
\mathbf{v_{cart}} &= \displaystyle \begin{pmatrix}\dot{x}\\0\end{pmatrix} \\%
\end{align*}%
Components are $v_{x,cart} = \dot{x}$ and $v_{y,cart} = 0$.%
Velocity of CM of Rod 1:%
\begin{align*}%
\mathbf{v_{cm1}} &= \displaystyle \begin{pmatrix}d_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\\- d_{1} \sin(\theta_1 ) \dot{\theta}_{1}\end{pmatrix} \\%
\end{align*}%
Velocity of CM of Rod 2:%
\begin{align*}%
\mathbf{v_{cm2}} &= \displaystyle \begin{pmatrix}d_{2} \cos(\theta_2 ) \dot{\theta}_{2} + l_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\\- d_{2} \sin(\theta_2 ) \dot{\theta}_{2} - l_{1} \sin(\theta_1 ) \dot{\theta}_{1}\end{pmatrix} \\%
\end{align*}

%
\section{3. Kinetic Energy (T)}%
\label{sec:3.KineticEnergy(T)}%
Total kinetic energy $T = T_{cart} + T_{rod1} + T_{rod2}$.%
$$ T_{cart} = \frac{1}{2} M v_{x,cart}^2 $$%
$$ T_{rod1} = \frac{1}{2} m_1 (v_{x,cm1}^2 + v_{y,cm1}^2) + \frac{1}{2} I_{cm1} \dot{\theta}_1^2 $$%
$$ T_{rod2} = \frac{1}{2} m_2 (v_{x,cm2}^2 + v_{y,cm2}^2) + \frac{1}{2} I_{cm2} \dot{\theta}_2^2 $$

%
\section{4. Potential Energy (V)}%
\label{sec:4.PotentialEnergy(V)}%
Zero potential at $y=0$. So $V = m_1 g\,y_{cm1} + m_2 g\,y_{cm2}$.%
\begin{align*}%
V &= \displaystyle d_{1} g m_{1} \cos(\theta_1 ) + g m_{2} \left(d_{2} \cos(\theta_2 ) + l_{1} \cos(\theta_1 )\right) \\%
\end{align*}

%
\section{5. Lagrangian (L)}%
\label{sec:5.Lagrangian(L)}%
The Lagrangian is $L = T - V$.

%
\section{6. Euler{-}Lagrange Equations}%
\label{sec:6.Euler{-}LagrangeEquations}%
$\frac{d}{dt}\bigl(\frac{\partial L}{\partial \dot{q}_i}\bigr) - \frac{\partial L}{\partial q_i} = Q_i$. For this system, $Q = [U, 0, 0]^T$.%
\paragraph{\textbf{Intermediate steps of the Euler{-}Lagrange equations:}}%
\label{para:textbfIntermediatestepsoftheEuler{-}Lagrangeequations}%

%
\begin{align*}%
&\text{Where: } \\%
&c_1 = \cos(\theta_1), \quad s_1 = \sin(\theta_1) \\%
&c_2 = \cos(\theta_2), \quad s_2 = \sin(\theta_2)%
\end{align*}%
\vspace{1em}%
\subsection{Partial derivatives with respect to velocities}%
\label{subsec:Partialderivativeswithrespecttovelocities}%
\paragraph{For coordinate \$x\$:}%
\label{para:Forcoordinatex}%

%
\begin{align*}%
\frac{\partial L}{\partial \dot{x}} &= \begin{aligned} \displaystyle 1.0 M \dot{x}  \\
& + 0.5 m_{1} \left(2 d_{1} \cos(\theta_1 ) \dot{\theta}_{1} + 2 \dot{x}\right) \\
&   \\
& + 0.5 m_{2} \left(2 d_{2} \cos(\theta_2 ) \dot{\theta}_{2} + 2 l_{1} \cos(\theta_1 ) \dot{\theta}_{1} + 2 \dot{x}\right)  \end{aligned} \\%
\end{align*}%
\paragraph{For coordinate \$\textbackslash{}theta\_1\$:}%
\label{para:Forcoordinatetheta1}%

%
\begin{align*}%
\frac{\partial L}{\partial \dot{\theta_1}} &= \begin{aligned} \displaystyle 1.0 Icm_{1} \dot{\theta}_{1}  \\
& + 0.5 m_{1} \left(2 d_{1}^{2} \sin^{2}(\theta_1 ) \dot{\theta}_{1} + 2 d_{1} \left(d_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\right) \cos(\theta_1 )\right) \\
&   \\
& + 0.5 m_{2} \left(- 2 l_{1} \left(- d_{2} \sin(\theta_2 ) \dot{\theta}_{2} - l_{1} \sin(\theta_1 ) \dot{\theta}_{1}\right) \sin(\theta_1 ) + 2 l_{1} \left(d_{2} \cos(\theta_2 ) \dot{\theta}_{2} + l_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\right) \cos(\theta_1 )\right)  \end{aligned} \\%
\end{align*}%
\paragraph{For coordinate \$\textbackslash{}theta\_2\$:}%
\label{para:Forcoordinatetheta2}%

%
\begin{align*}%
\frac{\partial L}{\partial \dot{\theta_2}} &= \begin{aligned} \displaystyle 1.0 Icm_{2} \dot{\theta}_{2}  \\
& + 0.5 m_{2} \left(- 2 d_{2} \left(- d_{2} \sin(\theta_2 ) \dot{\theta}_{2} - l_{1} \sin(\theta_1 ) \dot{\theta}_{1}\right) \sin(\theta_2 ) + 2 d_{2} \left(d_{2} \cos(\theta_2 ) \dot{\theta}_{2} + l_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\right) \cos(\theta_2 )\right)  \end{aligned} \\%
\end{align*}

%
\subsection{Time derivatives of partial derivatives}%
\label{subsec:Timederivativesofpartialderivatives}%
\paragraph{For coordinate \$x\$:}%
\label{para:Forcoordinatex}%

%
\begin{align*}%
\frac{d}{dt}\left(\frac{\partial L}{\partial \dot{x}}\right) &= \begin{aligned} \displaystyle 1.0 M \ddot{x}  \\
& + 0.5 m_{1} \left(- 2 d_{1} \sin(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2} + 2 d_{1} \cos(\theta_1 ) \ddot{\theta}_{1} + 2 \ddot{x}\right) \\
&   \\
& + 0.5 m_{2} \left(- 2 d_{2} \sin(\theta_2 ) \left(\dot{\theta}_{2}\right)^{2} + 2 d_{2} \cos(\theta_2 ) \ddot{\theta}_{2} - 2 l_{1} \sin(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2} + 2 l_{1} \cos(\theta_1 ) \ddot{\theta}_{1} + 2 \ddot{x}\right)  \end{aligned} \\%
\end{align*}%
\paragraph{For coordinate \$\textbackslash{}theta\_1\$:}%
\label{para:Forcoordinatetheta1}%

%
\begin{align*}%
\frac{d}{dt}\left(\frac{\partial L}{\partial \dot{\theta_1}}\right) &= \begin{aligned} \displaystyle 1.0 Icm_{1} \ddot{\theta}_{1}  \\
& + 0.5 m_{1} \left(2 d_{1}^{2} \sin^{2}(\theta_1 ) \ddot{\theta}_{1} + 4 d_{1}^{2} \sin(\theta_1 ) \cos(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2} - 2 d_{1} \left(d_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\right) \sin(\theta_1 ) \dot{\theta}_{1} + 2 d_{1} \left(- d_{1} \sin(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2} + d_{1} \cos(\theta_1 ) \ddot{\theta}_{1} + \ddot{x}\right) \cos(\theta_1 )\right) \\
&   \\
& + 0.5 m_{2} \left(- 2 l_{1} \left(- d_{2} \sin(\theta_2 ) \dot{\theta}_{2} - l_{1} \sin(\theta_1 ) \dot{\theta}_{1}\right) \cos(\theta_1 ) \dot{\theta}_{1} - 2 l_{1} \left(d_{2} \cos(\theta_2 ) \dot{\theta}_{2} + l_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\right) \sin(\theta_1 ) \dot{\theta}_{1} - 2 l_{1} \left(- d_{2} \sin(\theta_2 ) \ddot{\theta}_{2} - d_{2} \cos(\theta_2 ) \left(\dot{\theta}_{2}\right)^{2} - l_{1} \sin(\theta_1 ) \ddot{\theta}_{1} - l_{1} \cos(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2}\right) \sin(\theta_1 ) + 2 l_{1} \left(- d_{2} \sin(\theta_2 ) \left(\dot{\theta}_{2}\right)^{2} + d_{2} \cos(\theta_2 ) \ddot{\theta}_{2} - l_{1} \sin(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2} + l_{1} \cos(\theta_1 ) \ddot{\theta}_{1} + \ddot{x}\right) \cos(\theta_1 )\right)  \end{aligned} \\%
\end{align*}%
\paragraph{For coordinate \$\textbackslash{}theta\_2\$:}%
\label{para:Forcoordinatetheta2}%

%
\begin{align*}%
\frac{d}{dt}\left(\frac{\partial L}{\partial \dot{\theta_2}}\right) &= \begin{aligned} \displaystyle 1.0 Icm_{2} \ddot{\theta}_{2}  \\
& + 0.5 m_{2} \left(- 2 d_{2} \left(- d_{2} \sin(\theta_2 ) \dot{\theta}_{2} - l_{1} \sin(\theta_1 ) \dot{\theta}_{1}\right) \cos(\theta_2 ) \dot{\theta}_{2} - 2 d_{2} \left(d_{2} \cos(\theta_2 ) \dot{\theta}_{2} + l_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\right) \sin(\theta_2 ) \dot{\theta}_{2} - 2 d_{2} \left(- d_{2} \sin(\theta_2 ) \ddot{\theta}_{2} - d_{2} \cos(\theta_2 ) \left(\dot{\theta}_{2}\right)^{2} - l_{1} \sin(\theta_1 ) \ddot{\theta}_{1} - l_{1} \cos(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2}\right) \sin(\theta_2 ) + 2 d_{2} \left(- d_{2} \sin(\theta_2 ) \left(\dot{\theta}_{2}\right)^{2} + d_{2} \cos(\theta_2 ) \ddot{\theta}_{2} - l_{1} \sin(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2} + l_{1} \cos(\theta_1 ) \ddot{\theta}_{1} + \ddot{x}\right) \cos(\theta_2 )\right)  \end{aligned} \\%
\end{align*}

%
\subsection{Partial derivatives with respect to coordinates}%
\label{subsec:Partialderivativeswithrespecttocoordinates}%
\paragraph{For coordinate \$x\$:}%
\label{para:Forcoordinatex}%

%
\begin{align*}%
\frac{\partial L}{\partial x} &= \displaystyle 0 \\%
\end{align*}%
\paragraph{For coordinate \$\textbackslash{}theta\_1\$:}%
\label{para:Forcoordinatetheta1}%

%
\begin{align*}%
\frac{\partial L}{\partial \theta_1} &= \begin{aligned} \displaystyle d_{1} g m_{1}  \\
& \sin(\theta_1 )  \\
& + g l_{1} m_{2} \sin(\theta_1 )  \\
& + 0.5 m_{1} \left(2 d_{1}^{2} \sin(\theta_1 ) \cos(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2} - 2 d_{1} \left(d_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\right) \sin(\theta_1 ) \dot{\theta}_{1}\right) \\
&   \\
& + 0.5 m_{2} \left(- 2 l_{1} \left(- d_{2} \sin(\theta_2 ) \dot{\theta}_{2} - l_{1} \sin(\theta_1 ) \dot{\theta}_{1}\right) \cos(\theta_1 ) \dot{\theta}_{1} - 2 l_{1} \left(d_{2} \cos(\theta_2 ) \dot{\theta}_{2} + l_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\right) \sin(\theta_1 ) \dot{\theta}_{1}\right)  \end{aligned} \\%
\end{align*}%
\paragraph{For coordinate \$\textbackslash{}theta\_2\$:}%
\label{para:Forcoordinatetheta2}%

%
\begin{align*}%
\frac{\partial L}{\partial \theta_2} &= \begin{aligned} \displaystyle d_{2} g m_{2}  \\
& \sin(\theta_2 )  \\
& + 0.5 m_{2} \left(- 2 d_{2} \left(- d_{2} \sin(\theta_2 ) \dot{\theta}_{2} - l_{1} \sin(\theta_1 ) \dot{\theta}_{1}\right) \cos(\theta_2 ) \dot{\theta}_{2} - 2 d_{2} \left(d_{2} \cos(\theta_2 ) \dot{\theta}_{2} + l_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\right) \sin(\theta_2 ) \dot{\theta}_{2}\right)  \end{aligned} \\%
\end{align*}

%
\subsection{Complete Euler{-}Lagrange equations (LHS)}%
\label{subsec:CompleteEuler{-}Lagrangeequations(LHS)}%
\paragraph{For coordinate \$x\$:}%
\label{para:Forcoordinatex}%

%
\begin{align*}%
\frac{d}{dt}\left(\frac{\partial L}{\partial \dot{x}}\right) - \frac{\partial L}{\partial x} &= \begin{aligned} \displaystyle 1.0 M \ddot{x}  \\
& + 0.5 m_{1} \left(- 2 d_{1} \sin(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2} + 2 d_{1} \cos(\theta_1 ) \ddot{\theta}_{1} + 2 \ddot{x}\right) \\
&   \\
& + 0.5 m_{2} \left(- 2 d_{2} \sin(\theta_2 ) \left(\dot{\theta}_{2}\right)^{2} + 2 d_{2} \cos(\theta_2 ) \ddot{\theta}_{2} - 2 l_{1} \sin(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2} + 2 l_{1} \cos(\theta_1 ) \ddot{\theta}_{1} + 2 \ddot{x}\right)  \end{aligned} \\%
\end{align*}%
\paragraph{For coordinate \$\textbackslash{}theta\_1\$:}%
\label{para:Forcoordinatetheta1}%

%
\begin{align*}%
\frac{d}{dt}\left(\frac{\partial L}{\partial \dot{\theta_1}}\right) - \frac{\partial L}{\partial \theta_1} &= \begin{aligned} \displaystyle 1.0 Icm_{1} \ddot{\theta}_{1}  \\
& - d_{1} g m_{1} \sin(\theta_1 )  \\
& - g l_{1} m_{2} \sin(\theta_1 )  \\
& - 0.5 m_{1} \left(2 d_{1}^{2} \sin(\theta_1 ) \cos(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2} - 2 d_{1} \left(d_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\right) \sin(\theta_1 ) \dot{\theta}_{1}\right) \\
&   \\
& + 0.5 m_{1} \left(2 d_{1}^{2} \sin^{2}(\theta_1 ) \ddot{\theta}_{1} + 4 d_{1}^{2} \sin(\theta_1 ) \cos(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2} - 2 d_{1} \left(d_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\right) \sin(\theta_1 ) \dot{\theta}_{1} + 2 d_{1} \left(- d_{1} \sin(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2} + d_{1} \cos(\theta_1 ) \ddot{\theta}_{1} + \ddot{x}\right) \cos(\theta_1 )\right) \\
&   \\
& - 0.5 m_{2} \left(- 2 l_{1} \left(- d_{2} \sin(\theta_2 ) \dot{\theta}_{2} - l_{1} \sin(\theta_1 ) \dot{\theta}_{1}\right) \cos(\theta_1 ) \dot{\theta}_{1} - 2 l_{1} \left(d_{2} \cos(\theta_2 ) \dot{\theta}_{2} + l_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\right) \sin(\theta_1 ) \dot{\theta}_{1}\right) \\
&   \\
& + 0.5 m_{2} \left(- 2 l_{1} \left(- d_{2} \sin(\theta_2 ) \dot{\theta}_{2} - l_{1} \sin(\theta_1 ) \dot{\theta}_{1}\right) \cos(\theta_1 ) \dot{\theta}_{1} - 2 l_{1} \left(d_{2} \cos(\theta_2 ) \dot{\theta}_{2} + l_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\right) \sin(\theta_1 ) \dot{\theta}_{1} - 2 l_{1} \left(- d_{2} \sin(\theta_2 ) \ddot{\theta}_{2} - d_{2} \cos(\theta_2 ) \left(\dot{\theta}_{2}\right)^{2} - l_{1} \sin(\theta_1 ) \ddot{\theta}_{1} - l_{1} \cos(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2}\right) \sin(\theta_1 ) + 2 l_{1} \left(- d_{2} \sin(\theta_2 ) \left(\dot{\theta}_{2}\right)^{2} + d_{2} \cos(\theta_2 ) \ddot{\theta}_{2} - l_{1} \sin(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2} + l_{1} \cos(\theta_1 ) \ddot{\theta}_{1} + \ddot{x}\right) \cos(\theta_1 )\right)  \end{aligned} \\%
\end{align*}%
\paragraph{For coordinate \$\textbackslash{}theta\_2\$:}%
\label{para:Forcoordinatetheta2}%

%
\begin{align*}%
\frac{d}{dt}\left(\frac{\partial L}{\partial \dot{\theta_2}}\right) - \frac{\partial L}{\partial \theta_2} &= \begin{aligned} \displaystyle 1.0 Icm_{2} \ddot{\theta}_{2}  \\
& - d_{2} g m_{2} \sin(\theta_2 )  \\
& - 0.5 m_{2} \left(- 2 d_{2} \left(- d_{2} \sin(\theta_2 ) \dot{\theta}_{2} - l_{1} \sin(\theta_1 ) \dot{\theta}_{1}\right) \cos(\theta_2 ) \dot{\theta}_{2} - 2 d_{2} \left(d_{2} \cos(\theta_2 ) \dot{\theta}_{2} + l_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\right) \sin(\theta_2 ) \dot{\theta}_{2}\right) \\
&   \\
& + 0.5 m_{2} \left(- 2 d_{2} \left(- d_{2} \sin(\theta_2 ) \dot{\theta}_{2} - l_{1} \sin(\theta_1 ) \dot{\theta}_{1}\right) \cos(\theta_2 ) \dot{\theta}_{2} - 2 d_{2} \left(d_{2} \cos(\theta_2 ) \dot{\theta}_{2} + l_{1} \cos(\theta_1 ) \dot{\theta}_{1} + \dot{x}\right) \sin(\theta_2 ) \dot{\theta}_{2} - 2 d_{2} \left(- d_{2} \sin(\theta_2 ) \ddot{\theta}_{2} - d_{2} \cos(\theta_2 ) \left(\dot{\theta}_{2}\right)^{2} - l_{1} \sin(\theta_1 ) \ddot{\theta}_{1} - l_{1} \cos(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2}\right) \sin(\theta_2 ) + 2 d_{2} \left(- d_{2} \sin(\theta_2 ) \left(\dot{\theta}_{2}\right)^{2} + d_{2} \cos(\theta_2 ) \ddot{\theta}_{2} - l_{1} \sin(\theta_1 ) \left(\dot{\theta}_{1}\right)^{2} + l_{1} \cos(\theta_1 ) \ddot{\theta}_{1} + \ddot{x}\right) \cos(\theta_2 )\right)  \end{aligned} \\%
\end{align*}

%
\section{7. Solving for Accelerations}%
\label{sec:7.SolvingforAccelerations}%
The equations can be written in the form \$M(q)\textbackslash{}ddot\{q\} + C(q,\textbackslash{}dot\{q\})\textbackslash{}dot\{q\} + G(q) = \textbackslash{}tau\$.%
\paragraph{\textbf{Mass Matrix M(q) elements:}}%
\label{para:textbfMassMatrixM(q)elements}%

%
\begin{align*}%
M_{11} &= 1.0 M \\%
M_{22} &= 1.0 Icm_{1} \\%
M_{33} &= 1.0 Icm_{2} \\%
\end{align*}%
\vspace{1em}%
\paragraph{\textbf{Calculated RHS Vector \$\textbackslash{}tau {-} (C\textbackslash{}dot\{q\}+G)\$: (Simplified using CSE)}}%
\label{para:textbfCalculatedRHSVectortextbackslashtau{-}(Ctextbackslashdotq+G)(SimplifiedusingCSE)}%

%
\textbf{Common Subexpressions:}\\ \vspace{0.5em}%
\begin{align*}%
x_{0} &= \displaystyle 1.0 \dot{x} \\%
x_{1} &= \displaystyle \theta_1 \\%
x_{2} &= \displaystyle \frac{d}{d t} x_{1} \\%
x_{3} &= \displaystyle x_{2}^{2} \\%
x_{4} &= \displaystyle \sin(x_{1} ) \\%
x_{5} &= \displaystyle 1.0 x_{3} x_{4} \\%
x_{6} &= \displaystyle \theta_2 \\%
x_{7} &= \displaystyle \frac{d}{d t} x_{6} \\%
x_{8} &= \displaystyle x_{7}^{2} \\%
x_{9} &= \displaystyle 1.0 d_{2} m_{2} \\%
x_{10} &= \displaystyle x_{9} \sin(x_{6} ) \\%
x_{11} &= \displaystyle l_{1} x_{9} \sin(x_{1} - x_{6} ) \\%
\end{align*}%
\vspace{1em}%
\begin{align*}%
\tau - (C\dot{q}+G) &= \displaystyle \begin{matrix}1.0 U gear - b_{fric} x_{0} - b_{slide} x_{0} + d_{1} m_{1} x_{5} + l_{1} m_{2} x_{5} + x_{10} x_{8}\\- 1.0 b_{joint1} x_{2} + 1.0 d_{1} g m_{1} x_{4} + 1.0 g l_{1} m_{2} x_{4} - x_{11} x_{8}\\- 1.0 b_{joint2} x_{7} + g x_{10} + x_{11} x_{3}\end{matrix} \\%
\end{align*}

%
\section{8. Equations of Motion (Accelerations)}%
\label{sec:8.EquationsofMotion(Accelerations)}%
Final expressions for the accelerations are (Simplified using CSE):%
\textbf{Common Subexpressions:}\\ \vspace{0.5em}%
\begin{align*}%
x_{0} &= \displaystyle \dot{x} \\%
x_{1} &= \displaystyle \theta_1 \\%
x_{2} &= \displaystyle \frac{d}{d t} x_{1} \\%
x_{3} &= \displaystyle x_{2}^{2} \\%
x_{4} &= \displaystyle \sin(x_{1} ) \\%
x_{5} &= \displaystyle x_{3} x_{4} \\%
x_{6} &= \displaystyle \theta_2 \\%
x_{7} &= \displaystyle \frac{d}{d t} x_{6} \\%
x_{8} &= \displaystyle x_{7}^{2} \\%
x_{9} &= \displaystyle d_{2} m_{2} \\%
x_{10} &= \displaystyle x_{9} \sin(x_{6} ) \\%
x_{11} &= \displaystyle l_{1} x_{9} \sin(x_{1} - x_{6} ) \\%
\end{align*}%
\vspace{1em}%
\subsection{Acceleration of the cart}%
\label{subsec:Accelerationofthecart}%
\begin{align*}%
\ddot{x} &= \displaystyle 1.0 \left(U gear - b_{fric} x_{0} - b_{slide} x_{0} + d_{1} m_{1} x_{5} + l_{1} m_{2} x_{5} + x_{10} x_{8}\right) / M \\%
\end{align*}

%
\subsection{Angular Acceleration of Rod 1}%
\label{subsec:AngularAccelerationofRod1}%
\begin{align*}%
\ddot{\theta}_1 &= \displaystyle 1.0 \left(- b_{joint1} x_{2} + d_{1} g m_{1} x_{4} + g l_{1} m_{2} x_{4} - x_{11} x_{8}\right) / Icm_{1} \\%
\end{align*}

%
\subsection{Angular Acceleration of Rod 2}%
\label{subsec:AngularAccelerationofRod2}%
\begin{align*}%
\ddot{\theta}_2 &= \displaystyle 1.0 \left(- b_{joint2} x_{7} + g x_{10} + x_{11} x_{3}\right) / Icm_{2} \\%
\end{align*}

%
\section{9. Uniform Rod Case}%
\label{sec:9.UniformRodCase}%
Substituting uniform rods: \$d\_1 = l\_1/2, d\_2 = l\_2/2\$.%
\paragraph{\textbf{Mass Matrix M(q) (Uniform Rods):}}%
\label{para:textbfMassMatrixM(q)(UniformRods)}%

%
\begin{align*}%
M_{uniform}(q) &= \displaystyle \begin{matrix}1.0 M & 0 & 0\\0 & 1.0 Icm_{1} & 0\\0 & 0 & 1.0 Icm_{2}\end{matrix} \\%
\end{align*}%
\paragraph{\textbf{Accelerations (Uniform Rods): (Simplified using CSE)}}%
\label{para:textbfAccelerations(UniformRods)(SimplifiedusingCSE)}%

%
\textbf{Common Subexpressions:}\\ \vspace{0.5em}%
\begin{align*}%
x_{0} &= \displaystyle 1.0 \dot{x} \\%
x_{1} &= \displaystyle \theta_1 \\%
x_{2} &= \displaystyle \frac{d}{d t} x_{1} \\%
x_{3} &= \displaystyle x_{2}^{2} \\%
x_{4} &= \displaystyle \sin(x_{1} ) \\%
x_{5} &= \displaystyle l_{1} x_{3} x_{4} \\%
x_{6} &= \displaystyle \theta_2 \\%
x_{7} &= \displaystyle \frac{d}{d t} x_{6} \\%
x_{8} &= \displaystyle x_{7}^{2} \\%
x_{9} &= \displaystyle 0.5 l_{2} m_{2} \\%
x_{10} &= \displaystyle x_{9} \sin(x_{6} ) \\%
x_{11} &= \displaystyle l_{1} x_{9} \sin(x_{1} - x_{6} ) \\%
\end{align*}%
\vspace{1em}%
\begin{align*}%
\ddot{x} &= \displaystyle \left(1.0 U gear - b_{fric} x_{0} - b_{slide} x_{0} + 0.5 m_{1} x_{5} + 1.0 m_{2} x_{5} + x_{10} x_{8}\right) / M \\%
\end{align*}%
\begin{align*}%
\ddot{\theta}_1 &= \displaystyle \left(- 1.0 b_{joint1} x_{2} + 0.5 g l_{1} m_{1} x_{4} + 1.0 g l_{1} m_{2} x_{4} - x_{11} x_{8}\right) / Icm_{1} \\%
\end{align*}%
\begin{align*}%
\ddot{\theta}_2 &= \displaystyle \left(- 1.0 b_{joint2} x_{7} + g x_{10} + x_{11} x_{3}\right) / Icm_{2} \\%
\end{align*}

%
\end{document}